import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as a}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:t}=await e("vue"),{renderList:l,Fragment:o,openBlock:r,createElementBlock:n,toDisplayString:s,createElementVNode:c,resolveComponent:i,withCtx:u,createVNode:v,createTextVNode:d,createBlock:p,createCommentVNode:f}=await e("vue"),m={class:"main-container"},_={key:0,class:"grid grid-cols-1 gap-6"},h={class:"font-bold text-lg break-words leading-tight"},g={class:"flex items-center justify-between px-3 pb-2 gap-2"},y={class:"flex flex-col flex-1"},w={class:"text-sm break-all"},x={class:"text-sm"},k={key:1,class:"text-center py-4"},b={key:2,class:"text-center py-8"},C={class:"d-flex align-center mb-2"},{ref:j,reactive:V,onMounted:P,onUnmounted:B}=await e("vue"),D=a(t({__name:"Page",props:{api:{type:Object,required:!0},initialConfig:{type:Object,default:()=>({})}},emits:["close","switch","save"],setup(e,{emit:a}){const t=e,D=a,E=V({show:!1,text:"",color:"success",timeout:3e3});function F(e,a="success"){E.text=e,E.color=a,E.show=!0}const N=j(10),z=j(1),H=j([]),L=j([]),O=j(!1),T=j(!0),U=j(null),$=j({});const q=async()=>{try{U.value=null;const e=await t.api.get("plugin/FormatDownPath/processed_data");$.value=e,H.value=Object.keys(e).reverse(),console.log("成功加载基础数据，共",H.value.length,"条记录"),z.value=1,L.value=[],T.value=!0}catch(e){console.error("获取基础数据失败:",e),U.value="无法加载基础数据，请检查网络连接",T.value=!1}},I=async()=>{if(!O.value&&T.value){O.value=!0;try{const e=(z.value-1)*N.value,a=e+N.value,l=H.value.slice(e,a);if(!l.length)return void(T.value=!1);const o=(await Promise.all(l.map((e=>(async(e,a,t)=>{try{const o={...await t.get(`plugin/FormatDownPath/torrent_data?torrent_hash=${e}`),hash:e,downloader:a[e]||"未知下载器"};return"string"==typeof(l=o).hash&&"string"==typeof l.name&&"string"==typeof l.save_path&&"number"==typeof l.files_count?o:null}catch(o){return console.error(`加载种子数据失败 (${e}):`,o),null}var l})(e,$.value,t.api))))).filter(Boolean);L.value.push(...o),z.value++,T.value=a<H.value.length,o.length||2!==z.value||(T.value=!1,console.error("没有更多数据了"))}catch(e){U.value="数据加载失败，请尝试刷新页面",console.error("分页加载异常:",e)}finally{O.value=!1}}},M=j(),S=()=>{if(!M.value||O.value)return;const{scrollTop:e,scrollHeight:a,clientHeight:t}=M.value;a-(e+t)<500&&I()};return P((async()=>{await q(),await I(),M.value?.addEventListener("scroll",S)})),B((()=>{M.value?.removeEventListener("scroll",S)})),(e,a)=>{const j=i("v-card-title"),V=i("v-btn"),P=i("v-card"),B=i("v-progress-circular"),N=i("v-icon"),S=i("v-alert"),A=i("v-card-actions"),G=i("v-container"),J=i("v-footer"),K=i("v-snackbar");return r(),n("div",m,[c("div",{ref_key:"container",ref:M,class:"scroll-content"},[L.value.length?(r(),n("div",_,[(r(!0),n(o,null,l(L.value,((e,l)=>(r(),p(P,{key:l,elevation:"2",hover:"",class:"transition-all duration-300"},{default:u((()=>[v(j,{class:"px-3 pt-2 pb-1"},{default:u((()=>[c("div",h,s(e.name),1)])),_:2},1024),c("div",g,[c("div",y,[c("div",w," 下载器: "+s(e.downloader)+" 原路径: "+s(e.save_path),1),c("div",x," 文件数: "+s(e.files_count)+" | Hash: "+s(e.hash),1)]),v(V,{color:"primary",size:"small",elevation:"20",rounded:"xl",onClick:a=>(async(e,a)=>{try{O.value=!0;const[l,o]=await t.api.post("plugin/FormatDownPath/recover_from_history",{downloader:a,torrent_hash:e});l?(F(o),L.value=L.value.filter((a=>a.hash!==e)),delete $.value[e],H.value=H.value.filter((a=>a!==e))):F(o,"error"),z.value>1&&await I()}catch(l){U.value="恢复操作失败，请检查下载器状态",console.error("恢复异常:",l)}finally{O.value=!1}})(e.hash,e.downloader)},{default:u((()=>a[4]||(a[4]=[d(" 恢复 ")]))),_:2,__:[4]},1032,["onClick"])])])),_:2},1024)))),128))])):f("",!0),O.value?(r(),n("div",k,[v(B,{indeterminate:"",color:"primary"}),a[5]||(a[5]=c("div",{class:"mt-2 text-gray-600"},"正在加载更多数据...",-1))])):T.value||0!==L.value.length?f("",!0):(r(),n("div",b,[v(N,{size:"48",color:"grey"},{default:u((()=>a[6]||(a[6]=[d("mdi-package-variant-remove")]))),_:1,__:[6]}),a[7]||(a[7]=c("div",{class:"mt-2 text-gray-600"},"未找到可恢复的备份数据",-1))]))],512),v(J,{class:"footer-bar"},{default:u((()=>[v(G,{class:"d-flex flex-column"},{default:u((()=>[c("div",C,[v(S,{type:"warning",variant:"tonal",class:"flex-grow-1"},{default:u((()=>a[8]||(a[8]=[d(" 注意：插件重置后备份数据会被清除 ")]))),_:1,__:[8]}),U.value?(r(),p(S,{key:0,type:"error",class:"mt-2 ml-2 flex-grow-1"},{default:u((()=>[d(s(U.value)+" ",1),v(V,{onClick:q,variant:"text",size:"small",class:"ml-2"},{default:u((()=>a[9]||(a[9]=[d("重试")]))),_:1,__:[9]})])),_:1})):f("",!0)]),v(A,{class:"px-2 py-1 d-flex justify-space-between"},{default:u((()=>[v(V,{color:"info",onClick:a[0]||(a[0]=e=>D("switch")),"prepend-icon":"mdi-view-dashboard",variant:"text"},{default:u((()=>a[10]||(a[10]=[d(" 配置页 ")]))),_:1,__:[10]}),v(V,{color:"grey",onClick:a[1]||(a[1]=e=>D("close")),"prepend-icon":"mdi-close",variant:"text"},{default:u((()=>a[11]||(a[11]=[d(" 关闭 ")]))),_:1,__:[11]})])),_:1})])),_:1})])),_:1}),v(K,{modelValue:E.show,"onUpdate:modelValue":a[3]||(a[3]=e=>E.show=e),color:E.color,timeout:E.timeout},{actions:u((()=>[v(V,{variant:"text",onClick:a[2]||(a[2]=e=>E.show=!1)},{default:u((()=>a[12]||(a[12]=[d(" 关闭 ")]))),_:1,__:[12]})])),default:u((()=>[d(s(E.text)+" ",1)])),_:1},8,["modelValue","color","timeout"])])}}}),[["__scopeId","data-v-e15d47a7"]]);export{D as default};
