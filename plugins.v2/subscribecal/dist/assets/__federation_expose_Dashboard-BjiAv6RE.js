import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as t}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:a}=await e("vue"),{renderList:r,Fragment:l,openBlock:s,createElementBlock:n,createElementVNode:o,normalizeClass:i,toDisplayString:c,createTextVNode:d,resolveComponent:u,withCtx:p,createVNode:m,createBlock:f}=await e("vue"),v={class:"stacked-cards"},g=["src"],w={class:"d-flex justify-space-between flex-nowrap flex-row"},y={class:"ma-auto"},_={class:"w-full h-full"},h={class:"mr-4"},{computed:b,ref:k}=await e("vue"),x=t(a({__name:"CalendarEvent",props:{events:{type:Object,default:()=>{}},position:{type:String,default:"top"}},setup(e){const t=e,a=k(!1),x=()=>{a.value=!0},D=e=>{e.target.classList.contains("modal-dialog")&&(a.value=!1)},C=e=>{if(!/^\d{8}T\d{6}Z$/.test(e))return console.warn(`Invalid date format: ${e}`),null;const t=parseInt(e.slice(0,4),10),a=parseInt(e.slice(4,6),10)-1,r=parseInt(e.slice(6,8),10),l=parseInt(e.slice(9,11),10),s=parseInt(e.slice(11,13),10),n=parseInt(e.slice(13,15),10);return new Date(Date.UTC(t,a,r,l,s,n))};function V(e){if("1600"===e.dtstart?.slice(9,13)&&"1600"===e.dtend?.slice(9,13))return"purple";const t=C(e.dtstart);if(!t)return"grey";const a=new Date(t.getTime()+6e4*(new Date).getTimezoneOffset()).getHours();return a>=6&&a<12?"amber":a>=12&&a<14?"yellow":a>=14&&a<18?"blue":a>=18&&a<20?"orange":a>=20||a<6?"deep-purple":"grey"}const T=b((()=>{const e=t.events.items;return Array.isArray(e)&&0!==e.length?e.filter((e=>e?.dtstart)).sort(((e,t)=>{const a=e=>`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}T${e.slice(9,11)}:${e.slice(11,13)}:${e.slice(13,15)}Z`,r=Date.parse(a(e.dtstart)),l=Date.parse(a(t.dtstart));return isNaN(r)||isNaN(l)?isNaN(r)?1:-1:r-l})):[]}));function I(e){switch(e.toLowerCase()){case"电视剧":return"mdi-television-play";case"电影":return"mdi-filmstrip";default:return"mdi-help-box"}}return(t,b)=>{const k=u("v-card-title"),N=u("VSkeletonLoader"),S=u("VImg"),j=u("VCardSubtitle"),$=u("v-icon"),B=u("VCardText"),M=u("VCard"),z=u("v-timeline-item"),E=u("v-timeline"),O=u("v-card-text"),L=u("v-card"),F=u("v-dialog");return s(),n("div",{class:"card-container",onClick:x},[o("div",v,[(s(!0),n(l,null,r(T.value.slice(0,4),((t,a)=>(s(),n("div",{key:t.id||a,class:i(["stacked-image",`image-${e.position}`])},[o("img",{src:0===a?t.poster:t.backdrop},null,8,g)],2)))),128)),o("div",{class:i(["titles-container",`title-${e.position}`])},c(T.value[0]?.summary),3)]),m(F,{modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=e=>a.value=e),"max-width":"50rem",scrollable:""},{default:p((()=>[o("div",{class:"modal-content",onClick:D},[m(L,null,{default:p((()=>[m(k,{class:"bg-primary-lighten-5"},{default:p((()=>[d(c(e.events.date),1)])),_:1}),m(O,{class:"py-4"},{default:p((()=>[m(E,{side:"end",direction:"vertical","line-color":"primary",class:"dense-timeline"},{default:p((()=>[(s(!0),n(l,null,r(T.value,((e,t)=>(s(),f(z,{key:e.uid,size:"small","dot-color":V(e),icon:I(e.type)},{default:p((()=>[m(M,null,{default:p((()=>[o("div",w,[o("div",y,[m(S,{height:"75",width:"50",src:e.poster,"aspect-ratio":"2/3",class:"object-cover rounded ring-gray-500",cover:""},{placeholder:p((()=>[o("div",_,[m(N,{class:"object-cover aspect-w-2 aspect-h-3"})])])),_:2},1032,["src"])]),o("div",null,[m(j,{class:"pa-1 px-2 font-bold break-words whitespace-break-spaces"},{default:p((()=>[d(c(e.summary),1)])),_:2},1024),m(B,{class:"pa-0 px-2 break-words"},{default:p((()=>[m($,{small:"",color:"amber",class:"mr-1"},{default:p((()=>b[1]||(b[1]=[d("mdi-star")]))),_:1}),o("span",h,c(e.vote??"暂无"),1),m($,{small:"",color:"primary",class:"mr-1"},{default:p((()=>b[2]||(b[2]=[d("mdi-clock-time-four-outline")]))),_:1}),o("span",null,c(C(e.dtstart)?.toTimeString().slice(0,5))+" - "+c(C(e.dtend)?.toTimeString().slice(0,5)),1)])),_:2},1024)])])])),_:2},1024)])),_:2},1032,["dot-color","icon"])))),128))])),_:1})])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-8a421d56"]]),{defineComponent:D}=await e("vue"),{toDisplayString:C,createTextVNode:V,resolveComponent:T,withCtx:I,createVNode:N,openBlock:S,createBlock:j,createCommentVNode:$,createElementBlock:B,renderList:M,Fragment:z,createElementVNode:E}=await e("vue"),O={class:"dashboard-widget"},L={key:0,class:"d-flex justify-center align-center py-4"},F={key:1,class:"timeline-container px-2"},A={class:"absolute right-5 top-5"},{ref:U,computed:Y,onMounted:Z,reactive:q}=await e("vue"),G=t(D({__name:"Dashboard",props:{config:{type:Object,default:()=>({})},allowRefresh:{type:Boolean,default:!0},api:{type:Object,required:!0}},setup(e){const t=e,a=q([]),r=U(!0),l=U(!1);const s=q({before:0,after:0});const n=Y((()=>{console.log("[getDisplayedGroups] 计算显示的分组...");const e=function(){l.value;const e=(new Date).toISOString().split("T")[0],t=a.findIndex((t=>t.date===e));if(-1!==t)return t;const r=a.findIndex((e=>{const t=new Date(e.date),a=new Date;return t>=new Date(a.getFullYear(),a.getMonth(),a.getDate())}));return-1!==r?r:0}();if(-1===e)return[];const t=function(e){const t=new Set,a=[];for(const r of e)t.has(r.date)||(t.add(r.date),a.push(r));return a}(a);if(l.value)return t;{const a=Math.max(0,e-2),r=Math.min(t.length-1,e+4);return t.slice(a,r+1)}}));function o(e){const t=new Date,[a,r,l]=e.date.split("-").map(Number),s=new Date(a,r-1,l),n=Math.ceil((s.getTime()-t.getTime())/864e5);return s<new Date(t.getFullYear(),t.getMonth(),t.getDate())?"grey":0===n?"primary":n<=3?"warning":"success"}function i(e){return 1===e.items.length?"x-small":e.items.length<=4?"small":"regular"}return Z((async()=>{await async function(e,r){try{const l=await t.api.get("plugin/SubscribeCal/grouped_events",{params:{before_days:e,after_days:r}}),n=Object.entries(l).map((([e,t])=>({date:e,items:t}))).sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),o=new Map;n.forEach((e=>{o.has(e.date)||o.set(e.date,e)}));const i=Array.from(o.values());e>s.before&&(a.unshift(...i),s.before=e),r>s.after&&(a.push(...i),s.after=r)}catch(l){console.error(l)}}(4,5),r.value=!1})),(t,a)=>{const l=T("v-card-title"),s=T("v-card-item"),c=T("v-progress-circular"),d=T("v-timeline-item"),u=T("v-timeline"),p=T("v-card-text"),m=T("VIcon"),f=T("v-card");return S(),B("div",O,[N(f,null,{default:I((()=>[e.config?.attrs?.title?(S(),j(s,{key:0},{default:I((()=>[N(l,null,{default:I((()=>[V(C(e.config?.attrs?.title),1)])),_:1})])),_:1})):$("",!0),N(p,null,{default:I((()=>[r.value?(S(),B("div",L,[N(c,{indeterminate:"",color:"primary"})])):(S(),B("div",F,[N(u,{direction:"horizontal",align:"center","line-color":"primary",class:"dense-timeline"},{default:I((()=>[(S(!0),B(z,null,M(n.value,((e,t)=>(S(),j(d,{key:e.date,"dot-color":o(e),size:i(e)},{opposite:I((()=>[V(C(e.date),1)])),default:I((()=>[N(x,{events:e,position:t%2==0?"top":"bottom"},null,8,["events","position"])])),_:2},1032,["dot-color","size"])))),128))])),_:1})]))])),_:1}),E("div",A,[N(m,{class:"cursor-move"},{default:I((()=>a[0]||(a[0]=[V("mdi-drag")]))),_:1})])])),_:1})])}}}),[["__scopeId","data-v-0506659c"]]);export{G as default};
