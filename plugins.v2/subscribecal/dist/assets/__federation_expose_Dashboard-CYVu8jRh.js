import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as t}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:a}=await e("vue"),{renderList:r,Fragment:l,openBlock:n,createElementBlock:s,createElementVNode:i,normalizeClass:o,toDisplayString:c,createTextVNode:d,resolveComponent:u,withCtx:p,createVNode:m,createBlock:f}=await e("vue"),v={class:"stacked-cards"},g=["src"],_={class:"d-flex justify-space-between flex-nowrap flex-row"},w={class:"ma-auto"},h={class:"w-full h-full"},C={class:"mr-4"},{computed:y,ref:b}=await e("vue"),D=t(a({__name:"CalendarEvent",props:{events:{type:Object,default:()=>{}},position:{type:String,default:"top"}},setup(e){const t=e,a=b(!1),D=()=>{a.value=!0},k=e=>{e.target.classList.contains("modal-dialog")&&(a.value=!1)},x=e=>{if(!/^\d{8}T\d{6}Z$/.test(e))return console.warn(`Invalid date format: ${e}`),null;const t=parseInt(e.slice(0,4),10),a=parseInt(e.slice(4,6),10)-1,r=parseInt(e.slice(6,8),10),l=parseInt(e.slice(9,11),10),n=parseInt(e.slice(11,13),10),s=parseInt(e.slice(13,15),10);return new Date(Date.UTC(t,a,r,l,n,s))};function F(e){if("1600"===e.dtstart?.slice(9,13)&&"1600"===e.dtend?.slice(9,13))return"#9C27B0";const t=x(e.dtstart);if(!t)return"#CCCCCC";const a=new Date(t.getTime()+6e4*(new Date).getTimezoneOffset()).getHours();return a>=6&&a<12?"#FFA000":a>=12&&a<14?"#FFF176":a>=14&&a<18?"#4DD0E1":a>=18&&a<20?"#FB8C00":a>=20||a<6?"#303F9F":"#CCCCCC"}const V=y((()=>{const e=t.events.items;return Array.isArray(e)&&0!==e.length?e.filter((e=>e?.dtstart)).sort(((e,t)=>{const a=e=>`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}T${e.slice(9,11)}:${e.slice(11,13)}:${e.slice(13,15)}Z`,r=Date.parse(a(e.dtstart)),l=Date.parse(a(t.dtstart));if(isNaN(r))return 1;if(isNaN(l))return-1;if(r!==l)return r-l;if(e.id!==t.id)return e.id<t.id?-1:1;const n=null!=e.episode,s=null!=t.episode;return!n&&s?1:n&&!s?-1:n&&s?(e.episode??0)-(t.episode??0):0})):[]})),T=y((()=>{const e=new Set,t=[];for(const a of V.value)if(!e.has(a.id)&&(e.add(a.id),t.push(a),t.length>=4))break;return t}));function I(e){switch(e.toLowerCase()){case"电视剧":return"mdi-television-play";case"电影":return"mdi-filmstrip";default:return"mdi-help-box"}}return(t,y)=>{const b=u("v-card-title"),B=u("VSkeletonLoader"),N=u("VImg"),S=u("VCardSubtitle"),j=u("v-icon"),$=u("VCardText"),E=u("VCard"),M=u("v-timeline-item"),z=u("v-timeline"),O=u("v-card-text"),A=u("v-card"),L=u("v-dialog");return n(),s("div",{class:"card-container",onClick:D},[i("div",v,[(n(!0),s(l,null,r(T.value,((t,a)=>(n(),s("div",{key:t.id,class:o(["stacked-image",`image-${e.position}`])},[i("img",{src:0===a?t.poster:t.backdrop},null,8,g)],2)))),128)),i("div",{class:o(["titles-container",`title-${e.position}`])},c(V.value[0]?.summary),3)]),m(L,{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=e=>a.value=e),"max-width":"50rem",scrollable:""},{default:p((()=>[i("div",{class:"modal-content",onClick:k},[m(A,null,{default:p((()=>[m(b,{class:"bg-primary-lighten-5"},{default:p((()=>[d(c(e.events.date),1)])),_:1}),m(O,{class:"py-4"},{default:p((()=>[m(z,{side:"end",direction:"vertical","line-color":"primary",class:"dense-timeline scrollable-timeline"},{default:p((()=>[(n(!0),s(l,null,r(V.value,(e=>(n(),f(M,{key:e.uid,size:"small","dot-color":F(e),icon:I(e.type),"fill-dot":""},{default:p((()=>[m(E,null,{default:p((()=>[i("div",_,[i("div",w,[m(N,{height:"75",width:"50",src:e.poster,"aspect-ratio":"2/3",class:"object-cover rounded ring-gray-500",cover:""},{placeholder:p((()=>[i("div",h,[m(B,{class:"object-cover aspect-w-2 aspect-h-3"})])])),_:2},1032,["src"])]),i("div",null,[m(S,{class:"pa-1 px-2 font-bold break-words whitespace-break-spaces"},{default:p((()=>[d(c(e.summary),1)])),_:2},1024),m($,{class:"pa-0 px-2 break-words"},{default:p((()=>[m(j,{small:"",color:"#FFB400",class:"mr-1"},{default:p((()=>y[1]||(y[1]=[d("mdi-star")]))),_:1,__:[1]}),i("span",C,c(e.vote??"暂无"),1),m(j,{small:"",color:"primary",class:"mr-1"},{default:p((()=>y[2]||(y[2]=[d("mdi-clock-time-four-outline")]))),_:1,__:[2]}),i("span",null,c(x(e.dtstart)?.toTimeString().slice(0,5))+" - "+c(x(e.dtend)?.toTimeString().slice(0,5)),1)])),_:2},1024)])])])),_:2},1024)])),_:2},1032,["dot-color","icon"])))),128))])),_:1})])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-225563f0"]]),{defineComponent:k}=await e("vue"),{toDisplayString:x,createTextVNode:F,resolveComponent:V,withCtx:T,createVNode:I,openBlock:B,createBlock:N,createCommentVNode:S,createElementBlock:j,renderList:$,Fragment:E,createElementVNode:M}=await e("vue"),z={class:"dashboard-widget"},O={key:0,class:"d-flex justify-center align-center py-4"},A={key:1,class:"timeline-container px-2"},L={class:"absolute right-5 top-5"},{ref:U,computed:Y,onMounted:Z,reactive:q}=await e("vue"),G=t(k({__name:"Dashboard",props:{config:{type:Object,default:()=>({})},allowRefresh:{type:Boolean,default:!0},api:{type:Object,required:!0}},setup(e){const t=e,a=q([]),r=U(!0),l=U(!1);const n=q({before:0,after:0});const s=Y((()=>{console.log("[getDisplayedGroups] 计算显示的分组...");const e=function(){l.value;const e=(new Date).toISOString().split("T")[0],t=a.findIndex((t=>t.date===e));if(-1!==t)return t;const r=a.findIndex((e=>{const t=new Date(e.date),a=new Date;return t>=new Date(a.getFullYear(),a.getMonth(),a.getDate())}));return-1!==r?r:0}();if(-1===e)return[];const t=function(e){const t=new Set,a=[];for(const r of e)t.has(r.date)||(t.add(r.date),a.push(r));return a}(a);if(l.value)return t;{const a=Math.max(0,e-2),r=Math.min(t.length-1,e+4);return t.slice(a,r+1)}}));function i(e){const t=new Date,[a,r,l]=e.date.split("-").map(Number),n=new Date(a,r-1,l),s=Math.ceil((n.getTime()-t.getTime())/864e5);return n<new Date(t.getFullYear(),t.getMonth(),t.getDate())?"#CCCCCC":0===s?"#66BB6A":s<=3?"#FFC107":"#FF6D00"}function o(e){return 1===e.items.length?"x-small":e.items.length<=4?"small":"regular"}return Z((async()=>{await async function(e,r){try{const l=await t.api.get("plugin/SubscribeCal/grouped_events",{params:{before_days:e,after_days:r}}),s=Object.entries(l).map((([e,t])=>({date:e,items:t}))).sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),i=new Map;s.forEach((e=>{i.has(e.date)||i.set(e.date,e)}));const o=Array.from(i.values());e>n.before&&(a.unshift(...o),n.before=e),r>n.after&&(a.push(...o),n.after=r)}catch(l){console.error(l)}}(4,5),r.value=!1})),(t,a)=>{const l=V("v-card-title"),n=V("v-card-item"),c=V("v-progress-circular"),d=V("v-timeline-item"),u=V("v-timeline"),p=V("v-card-text"),m=V("VIcon"),f=V("v-card");return B(),j("div",z,[I(f,null,{default:T((()=>[e.config?.attrs?.title?(B(),N(n,{key:0},{default:T((()=>[I(l,null,{default:T((()=>[F(x(e.config?.attrs?.title),1)])),_:1})])),_:1})):S("",!0),I(p,null,{default:T((()=>[r.value?(B(),j("div",O,[I(c,{indeterminate:"",color:"primary"})])):(B(),j("div",A,[I(u,{direction:"horizontal",align:"center","line-color":"primary",class:"dense-timeline"},{default:T((()=>[(B(!0),j(E,null,$(s.value,((e,t)=>(B(),N(d,{key:e.date,"dot-color":i(e),size:o(e)},{opposite:T((()=>[F(x(e.date),1)])),default:T((()=>[I(D,{events:e,position:t%2==0?"top":"bottom"},null,8,["events","position"])])),_:2},1032,["dot-color","size"])))),128))])),_:1})]))])),_:1}),M("div",L,[I(m,{class:"cursor-move"},{default:T((()=>a[0]||(a[0]=[F("mdi-drag")]))),_:1,__:[0]})])])),_:1})])}}}),[["__scopeId","data-v-40ef9f16"]]);export{G as default};
