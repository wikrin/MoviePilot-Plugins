import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as t}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:a}=await e("vue"),{renderList:r,Fragment:n,openBlock:s,createElementBlock:l,createElementVNode:o,normalizeClass:i,toDisplayString:c,createTextVNode:d,resolveComponent:u,withCtx:m,createVNode:p,createBlock:f}=await e("vue"),v={class:"stacked-cards"},g=["src"],_={class:"d-flex flex-row align-center"},h={class:"mr-4"},w={class:"w-full h-full"},C={class:"mr-4"},{computed:y,ref:b}=await e("vue"),k=t(a({__name:"CalendarEvent",props:{events:{type:Object,default:()=>{}},position:{type:String,default:"top"}},setup(e){const t=e,a=b(!1),k=()=>{a.value=!0},x=e=>{e.target.classList.contains("modal-dialog")&&(a.value=!1)};function D(e){const t=e.dtstart?.getHours()??-1,a=e.dtstart?.getMinutes()??-1,r=e.dtend?.getHours()??-1,n=e.dtend?.getMinutes()??-1;return 0===t&&0===a&&23===r&&59===n?"#9C27B0":e.dtstart?t>=6&&t<12?"#FFA000":t>=12&&t<14?"#FFF176":t>=14&&t<18?"#4DD0E1":t>=18&&t<20?"#FB8C00":t>=20||t<6?"#303F9F":"#CCCCCC":"#CCCCCC"}const F=y((()=>{const e=t.events.items;return Array.isArray(e)&&0!==e.length?e.filter((e=>e.dtstart)).sort(((e,t)=>{const a=e.dtstart.getTime(),r=t.dtstart.getTime();if(isNaN(a))return 1;if(isNaN(r))return-1;if(a!==r)return a-r;if(e.id!==t.id)return e.id<t.id?-1:1;const n=null!=e.episode,s=null!=t.episode;return!n&&s?1:n&&!s?-1:n&&s?(e.episode??0)-(t.episode??0):0})):[]})),V=y((()=>{const e=new Set,t=[];for(const a of F.value)if(!e.has(a.id)&&(e.add(a.id),t.push(a),t.length>=4))break;return t}));function T(e){switch(e.toLowerCase()){case"电视剧":return"mdi-television-play";case"电影":return"mdi-filmstrip";default:return"mdi-help-box"}}return(t,y)=>{const b=u("v-card-title"),I=u("VSkeletonLoader"),B=u("VImg"),N=u("VCardSubtitle"),S=u("v-icon"),M=u("VCardText"),j=u("VCard"),E=u("v-timeline-item"),z=u("v-timeline"),A=u("v-card-text"),L=u("v-card"),O=u("v-dialog");return s(),l("div",{class:"card-container",onClick:k},[o("div",v,[(s(!0),l(n,null,r(V.value,((t,a)=>(s(),l("div",{key:t.id,class:i(["stacked-image",`image-${e.position}`])},[o("img",{src:0===a?t.poster:t.backdrop},null,8,g)],2)))),128)),o("div",{class:i(["titles-container",`title-${e.position}`])},c(F.value[0]?.summary),3)]),p(O,{modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=e=>a.value=e),"max-width":"50rem",scrollable:""},{default:m((()=>[o("div",{class:"modal-content",onClick:x},[p(L,null,{default:m((()=>[p(b,{class:"bg-primary-lighten-5"},{default:m((()=>[d(c(e.events.date),1)])),_:1}),p(A,{class:"py-4"},{default:m((()=>[p(z,{side:"end",direction:"vertical","line-color":"primary",class:"dense-timeline scrollable-timeline"},{default:m((()=>[(s(!0),l(n,null,r(F.value,(e=>(s(),f(E,{key:e.uid,size:"small","dot-color":D(e),icon:T(e.type),"fill-dot":""},{default:m((()=>[p(j,{class:"pl-4"},{default:m((()=>[o("div",_,[o("div",h,[p(B,{height:"75",width:"50",src:e.poster,"aspect-ratio":"2/3",class:"object-cover rounded ring-gray-500",cover:""},{placeholder:m((()=>[o("div",w,[p(I,{class:"object-cover aspect-w-2 aspect-h-3"})])])),_:2},1032,["src"])]),o("div",null,[p(N,{class:"pa-1 px-2 font-bold break-words whitespace-break-spaces"},{default:m((()=>[d(c(e.summary),1)])),_:2},1024),p(M,{class:"pa-0 px-2 break-words"},{default:m((()=>[p(S,{small:"",color:"#FFB400",class:"mr-1"},{default:m((()=>y[1]||(y[1]=[d("mdi-star")]))),_:1,__:[1]}),o("span",C,c(e.vote??"暂无"),1),p(S,{small:"",color:"primary",class:"mr-1"},{default:m((()=>y[2]||(y[2]=[d("mdi-clock-time-four-outline")]))),_:1,__:[2]}),o("span",null,c(e.dtstart.toTimeString().slice(0,5))+" - "+c(e.dtend.toTimeString().slice(0,5)),1)])),_:2},1024)])])])),_:2},1024)])),_:2},1032,["dot-color","icon"])))),128))])),_:1})])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-81930d69"]]),{defineComponent:x}=await e("vue"),{toDisplayString:D,createTextVNode:F,resolveComponent:V,withCtx:T,createVNode:I,openBlock:B,createBlock:N,createCommentVNode:S,createElementBlock:M,renderList:j,Fragment:E,createElementVNode:z}=await e("vue"),A={class:"dashboard-widget"},L={key:0,class:"d-flex justify-center align-center py-4"},O={key:1,class:"timeline-container px-2"},$={class:"absolute right-5 top-5"},{ref:H,computed:U,onMounted:Y,reactive:q}=await e("vue"),G=t(x({__name:"Dashboard",props:{config:{type:Object,default:()=>({})},allowRefresh:{type:Boolean,default:!0},api:{type:Object,required:!0}},setup(e){const t=e,a=q([]),r=H(!0),n=H(!1);const s=q({before:0,after:0});const l=e=>{if(!/^\d{8}T\d{6}Z$/.test(e))return console.warn(`Invalid date format: ${e}`),null;const t=parseInt(e.slice(0,4),10),a=parseInt(e.slice(4,6),10)-1,r=parseInt(e.slice(6,8),10),n=parseInt(e.slice(9,11),10),s=parseInt(e.slice(11,13),10),l=parseInt(e.slice(13,15),10);return new Date(Date.UTC(t,a,r,n,s,l))};function o(e=new Date){const t=6e4*e.getTimezoneOffset();return new Date(e.getTime()-t).toISOString().slice(0,10)}const i=U((()=>{console.log("[getDisplayedGroups] 计算显示的分组...");const e=function(){n.value;const e=o(),t=a.findIndex((t=>t.date===e));if(-1!==t)return t;const r=a.findIndex((e=>{const t=new Date(e.date),a=new Date;return t>=new Date(a.getFullYear(),a.getMonth(),a.getDate())}));return-1!==r?r:0}();if(-1===e)return[];const t=function(e){const t=new Set,a=[];for(const r of e)t.has(r.date)||(t.add(r.date),a.push(r));return a}(a);if(n.value)return t;{const a=Math.max(0,e-2),r=Math.min(t.length-1,e+4);return t.slice(a,r+1)}}));function c(e){const t=new Date,[a,r,n]=e.date.split("-").map(Number),s=new Date(a,r-1,n),l=Math.ceil((s.getTime()-t.getTime())/864e5);return s<new Date(t.getFullYear(),t.getMonth(),t.getDate())?"#CCCCCC":0===l?"#66BB6A":l<=3?"#FFC107":"#FF6D00"}function d(e){return 1===e.items.length?"x-small":e.items.length<=4?"small":"regular"}return Y((async()=>{await async function(e,r){try{const n=await t.api.get("plugin/SubscribeCal/grouped_events",{params:{before_days:e,after_days:r}}),i=new Map;n.forEach((e=>{const t=l(e.dtstart);if(t){const a=o(t),r=l(e.dtend);r&&(e.dtend=r);const n={...e,dtstart:t};i.has(a)||i.set(a,{date:a,items:[]}),i.get(a).items.push(n)}}));const c=Array.from(i.values()).sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),d=new Map;c.forEach((e=>{d.has(e.date)||d.set(e.date,e)}));const u=Array.from(d.values());e>s.before&&(a.unshift(...u),s.before=e),r>s.after&&(a.push(...u),s.after=r)}catch(n){console.error(n)}}(4,5),r.value=!1})),(t,a)=>{const n=V("v-card-title"),s=V("v-card-item"),l=V("v-progress-circular"),o=V("v-timeline-item"),u=V("v-timeline"),m=V("v-card-text"),p=V("VIcon"),f=V("v-card");return B(),M("div",A,[I(f,null,{default:T((()=>[e.config?.attrs?.title?(B(),N(s,{key:0},{default:T((()=>[I(n,null,{default:T((()=>[F(D(e.config?.attrs?.title),1)])),_:1})])),_:1})):S("",!0),I(m,null,{default:T((()=>[r.value?(B(),M("div",L,[I(l,{indeterminate:"",color:"primary"})])):(B(),M("div",O,[I(u,{direction:"horizontal",align:"center","line-color":"primary",class:"dense-timeline"},{default:T((()=>[(B(!0),M(E,null,j(i.value,((e,t)=>(B(),N(o,{key:e.date,"dot-color":c(e),size:d(e)},{opposite:T((()=>[F(D(e.date),1)])),default:T((()=>[I(k,{events:e,position:t%2==0?"top":"bottom"},null,8,["events","position"])])),_:2},1032,["dot-color","size"])))),128))])),_:1})]))])),_:1}),z("div",$,[I(p,{class:"cursor-move"},{default:T((()=>a[0]||(a[0]=[F("mdi-drag")]))),_:1,__:[0]})])])),_:1})])}}}),[["__scopeId","data-v-ee272b69"]]);export{G as default};
