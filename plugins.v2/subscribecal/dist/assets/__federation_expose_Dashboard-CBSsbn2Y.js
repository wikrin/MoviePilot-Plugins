import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as t}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:a}=await e("vue"),{renderList:l,Fragment:r,openBlock:s,createElementBlock:i,createElementVNode:n,normalizeClass:o,toDisplayString:c,createTextVNode:d,resolveComponent:u,withCtx:p,createVNode:m,createBlock:v}=await e("vue"),f={class:"stacked-cards"},g=["src"],y={class:"d-flex justify-space-between flex-nowrap flex-row"},_={class:"ma-auto"},w={class:"w-full h-full"},b={class:"mr-4"},{computed:h,ref:k}=await e("vue"),x=t(a({__name:"CalendarEvent",props:{events:{type:Object,default:()=>{}},position:{type:String,default:"top"}},setup(e){const t=e,a=k(!1),x=()=>{a.value=!0},C=e=>{e.target.classList.contains("modal-dialog")&&(a.value=!1)},V=e=>{if(!/^\d{8}T\d{6}Z$/.test(e))return console.warn(`Invalid date format: ${e}`),null;const t=parseInt(e.slice(0,4),10),a=parseInt(e.slice(4,6),10)-1,l=parseInt(e.slice(6,8),10),r=parseInt(e.slice(9,11),10),s=parseInt(e.slice(11,13),10),i=parseInt(e.slice(13,15),10);return new Date(Date.UTC(t,a,l,r,s,i))};function D(e){if("1600"===e.dtstart?.slice(9,13)&&"1600"===e.dtend?.slice(9,13))return"purple";const t=V(e.dtstart);if(!t)return"grey";const a=new Date(t.getTime()+6e4*(new Date).getTimezoneOffset()).getHours();return a>=6&&a<12?"amber":a>=12&&a<14?"yellow":a>=14&&a<18?"blue":a>=18&&a<20?"orange":a>=20||a<6?"deep-purple":"grey"}const N=h((()=>{const e=t.events.items;return Array.isArray(e)&&0!==e.length?e.filter((e=>e?.dtstart)).sort(((e,t)=>{const a=e=>`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}T${e.slice(9,11)}:${e.slice(11,13)}:${e.slice(13,15)}Z`,l=Date.parse(a(e.dtstart)),r=Date.parse(a(t.dtstart));return isNaN(l)||isNaN(r)?isNaN(l)?1:-1:l-r})):[]}));function T(e){switch(e.toLowerCase()){case"电视剧":return"mdi-television-play";case"电影":return"mdi-filmstrip";default:return"mdi-help-box"}}return(t,h)=>{const k=u("v-card-title"),j=u("VSkeletonLoader"),I=u("VImg"),$=u("VCardSubtitle"),S=u("v-icon"),B=u("VCardText"),z=u("VCard"),L=u("v-timeline-item"),O=u("v-timeline"),E=u("v-card-text"),F=u("v-card"),M=u("v-dialog");return s(),i("div",{class:"card-container",onClick:x},[n("div",f,[(s(!0),i(r,null,l(N.value.slice(0,4),((t,a)=>(s(),i("div",{key:t.id||a,class:o(["stacked-image",`image-${e.position}`])},[n("img",{src:0===a?t.poster:t.backdrop},null,8,g)],2)))),128)),n("div",{class:o(["titles-container",`title-${e.position}`])},c(N.value[0]?.summary),3)]),m(M,{modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=e=>a.value=e),"max-width":"50rem",scrollable:""},{default:p((()=>[n("div",{class:"modal-content",onClick:C},[m(F,null,{default:p((()=>[m(k,{class:"bg-primary-lighten-5"},{default:p((()=>[d(c(e.events.date),1)])),_:1}),m(E,{class:"py-4"},{default:p((()=>[m(O,{side:"end",direction:"vertical","line-color":"primary",class:"dense-timeline"},{default:p((()=>[(s(!0),i(r,null,l(N.value,((e,t)=>(s(),v(L,{key:t,size:"small","dot-color":D(e),icon:T(e.type)},{default:p((()=>[m(z,null,{default:p((()=>[n("div",y,[n("div",_,[m(I,{height:"75",width:"50",src:e.poster,"aspect-ratio":"2/3",class:"object-cover rounded ring-gray-500",cover:""},{placeholder:p((()=>[n("div",w,[m(j,{class:"object-cover aspect-w-2 aspect-h-3"})])])),_:2},1032,["src"])]),n("div",null,[m($,{class:"pa-1 px-2 font-bold break-words whitespace-break-spaces"},{default:p((()=>[d(c(e.summary),1)])),_:2},1024),m(B,{class:"pa-0 px-2 break-words"},{default:p((()=>[m(S,{small:"",color:"amber",class:"mr-1"},{default:p((()=>h[1]||(h[1]=[d("mdi-star")]))),_:1}),n("span",b,c(e.vote??"暂无"),1),m(S,{small:"",color:"primary",class:"mr-1"},{default:p((()=>h[2]||(h[2]=[d("mdi-clock-time-four-outline")]))),_:1}),n("span",null,c(V(e.dtstart)?.toTimeString().slice(0,5))+" - "+c(V(e.dtend)?.toTimeString().slice(0,5)),1)])),_:2},1024)])])])),_:2},1024)])),_:2},1032,["dot-color","icon"])))),128))])),_:1})])),_:1})])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-dddb5e18"]]),{defineComponent:C}=await e("vue"),{toDisplayString:V,createTextVNode:D,resolveComponent:N,withCtx:T,createVNode:j,openBlock:I,createBlock:$,createCommentVNode:S,createElementBlock:B,renderList:z,Fragment:L}=await e("vue"),O={class:"dashboard-widget"},E={key:0,class:"d-flex justify-center align-center py-4"},F={key:1,class:"timeline-container px-2"},{ref:M,computed:A,onMounted:U,reactive:Z}=await e("vue"),q=t(C({__name:"Dashboard",props:{config:{type:Object,default:()=>({})},allowRefresh:{type:Boolean,default:!0},api:{type:Object,required:!0}},setup(e){const t=e,a=Z([]),l=M(!0);function r(e){const t=new Date,[a,l,r]=e.date.split("-").map(Number),s=new Date(a,l-1,r),i=Math.ceil((s.getTime()-t.getTime())/864e5);return s<new Date(t.getFullYear(),t.getMonth(),t.getDate())?"grey":0===i?"primary":i<=3?"warning":"success"}function s(e){return 1===e.items.length?"x-small":e.items.length<=4?"small":"regular"}const i=A((()=>a.slice(0,3)));return U((async()=>{await async function(){try{const e=await t.api.get("plugin/SubscribeCal/grouped_events"),l=Object.entries(e).map((([e,t])=>({date:e,items:t})));a.push(...l)}catch(e){console.error(e)}}(),l.value=!1})),(t,a)=>{const n=N("v-card-title"),o=N("v-card-item"),c=N("v-progress-circular"),d=N("v-timeline-item"),u=N("v-timeline"),p=N("v-card-text"),m=N("v-card");return I(),B("div",O,[j(m,null,{default:T((()=>[e.config?.attrs?.title?(I(),$(o,{key:0},{default:T((()=>[j(n,null,{default:T((()=>[D(V(e.config?.attrs?.title),1)])),_:1})])),_:1})):S("",!0),j(p,null,{default:T((()=>[l.value?(I(),B("div",E,[j(c,{indeterminate:"",color:"primary"})])):(I(),B("div",F,[j(u,{direction:"horizontal",align:"center","line-color":"primary",class:"dense-timeline"},{default:T((()=>[(I(!0),B(L,null,z(i.value,((e,t)=>(I(),$(d,{key:t,"dot-color":r(e),size:s(e)},{opposite:T((()=>[D(V(e.date),1)])),default:T((()=>[j(x,{events:e,position:t%2==0?"top":"bottom"},null,8,["events","position"])])),_:2},1032,["dot-color","size"])))),128))])),_:1})]))])),_:1})])),_:1})])}}}),[["__scopeId","data-v-e49ef517"]]);export{q as default};
