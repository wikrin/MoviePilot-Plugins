import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as l}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:a}=await e("vue"),{resolveComponent:t,createVNode:s,createElementVNode:i,withCtx:o,createTextVNode:n,withModifiers:c,toDisplayString:d,openBlock:r,createElementBlock:u}=await e("vue"),m={class:"plugin-config"},p={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},f={class:"d-flex align-center"},v={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},g={class:"d-flex align-center"},y={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},b={class:"d-flex align-center"},_={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},x={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},h={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},w={class:"d-flex align-center mb-2"},{ref:V,reactive:C,onMounted:P}=await e("vue"),O=l(a({__name:"Config",props:{api:{type:Object,required:!0},initialConfig:{type:Object,default:()=>({})}},emits:["close","save"],setup(e,{emit:l}){const a=e,O=l,k=C({enabled:!1,calc_time:0,onlyonce:!1,interval_minutes:15,calname:"追剧日历",cron:""}),A=C({...k}),I=V(!0),j=V(null),M=V(null),N=V(null),U=V(!1),B=V({Basic:{APP_DOMAIN:null,API_TOKEN:null}});async function S(){try{const e=await a.api.get("plugin/SubscribeCal/download/calendar.ics",{responseType:"text"});console.log(e);const l=new Blob([e],{type:"text/calendar"}),t=window.URL.createObjectURL(l),s=document.createElement("a");s.href=t,s.setAttribute("download",`${A.calname}.ics`),document.body.appendChild(s),s.click(),s.remove(),E("ICS 文件已成功下载","success")}catch(e){console.error("ICS 文件下载失败:",e),E("ICS 文件下载失败","error")}}async function z(){try{let e=B.value.Basic.APP_DOMAIN;const l=B.value.Basic.API_TOKEN;if(!e)return void E("域名未配置","warning");let a=e;a.startsWith("http://")||a.startsWith("https://")||(a="http://"+a);const t=new URL(`${a}/plugin/SubscribeCal/subscribe`);t.searchParams.append("apikey",l),await navigator.clipboard.writeText(t.toString()),E("已复制到剪贴板！","success")}catch(e){console.error("操作失败:",e),E("复制失败，请检查浏览器权限或输入内容","error")}}const D=C({show:!1,text:"",color:"success",timeout:3e3});function E(e,l="success"){D.text=e,D.color=l,D.show=!0}async function T(){U.value=!0,M.value=null;try{O("save",{...A}),N.value="配置保存成功"}catch(e){console.error("保存配置失败:",e),M.value=e.message||"保存配置失败"}finally{U.value=!1}}function R(){Object.keys(k).forEach((e=>{A[e]=k[e]})),j.value&&j.value.resetValidation()}return P((()=>{a.initialConfig&&Object.keys(a.initialConfig).forEach((e=>{e in A&&(A[e]=a.initialConfig[e])})),async function(){try{const e=await a.api.get("system/env");if(e.success){for(const l of Object.keys(B.value))Object.keys(B.value[l]).forEach((a=>{e.data.hasOwnProperty(a)&&(B.value[l][a]=e.data[a])}));B.value.Basic.APP_DOMAIN||(B.value.Basic.APP_DOMAIN=`${window.location.origin}`)}}catch(e){console.log(e)}}()})),(e,l)=>{const a=t("v-icon"),V=t("v-card-title"),C=t("v-switch"),P=t("v-col"),k=t("v-row"),M=t("v-text-field"),N=t("v-card-text"),E=t("v-card"),L=t("v-divider"),$=t("v-btn"),K=t("v-alert"),W=t("v-spacer"),q=t("v-card-actions"),G=t("v-form"),F=t("v-snackbar");return r(),u("div",m,[s(E,{flat:"",class:"rounded border"},{default:o((()=>[s(V,{class:"text-subtitle-1 d-flex align-center px-3 py-2 bg-primary-lighten-5"},{default:o((()=>[s(a,{icon:"mdi-cog",class:"mr-2",color:"primary",size:"small"}),l[11]||(l[11]=i("span",null,"订阅日历配置",-1))])),_:1}),s(N,{class:"px-3 py-2"},{default:o((()=>[s(G,{ref_key:"form",ref:j,modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=e=>I.value=e),onSubmit:c(T,["prevent"])},{default:o((()=>[s(E,{flat:"",class:"rounded mb-3 border config-card"},{default:o((()=>[s(N,{class:"px-3 py-2"},{default:o((()=>[s(k,{dense:"","no-gutters":""},{default:o((()=>[s(P,{cols:"12",md:"4",class:"pr-md-2 pb-2"},{default:o((()=>[i("div",p,[i("div",f,[s(a,{icon:"mdi-power",size:"small",color:A.enabled?"info":"grey",class:"mr-3"},null,8,["color"]),l[12]||(l[12]=i("span",{class:"text-subtitle-2"},"启用插件",-1))]),s(C,{modelValue:A.enabled,"onUpdate:modelValue":l[0]||(l[0]=e=>A.enabled=e),color:"info",inset:"",density:"compact","hide-details":"",class:"small-switch"},null,8,["modelValue"])])])),_:1}),s(P,{cols:"12",md:"4",class:"pr-md-2 pb-2"},{default:o((()=>[i("div",v,[i("div",g,[s(a,{icon:"mdi-history",size:"small",color:A.calc_time?"info":"grey",class:"mr-3"},null,8,["color"]),l[13]||(l[13]=i("span",{class:"text-subtitle-2"},"根据下载记录补充时间",-1))]),s(C,{modelValue:A.calc_time,"onUpdate:modelValue":l[1]||(l[1]=e=>A.calc_time=e),color:"info",inset:"",density:"compact","hide-details":"",class:"small-switch"},null,8,["modelValue"])])])),_:1}),s(P,{cols:"12",md:"4",class:"pr-md-2 pb-2"},{default:o((()=>[i("div",y,[i("div",b,[s(a,{icon:"mdi-update",size:"small",color:A.enabled?"info":"grey",class:"mr-3"},null,8,["color"]),l[14]||(l[14]=i("span",{class:"text-subtitle-2"},"立即更新一次",-1))]),s(C,{modelValue:A.onlyonce,"onUpdate:modelValue":l[2]||(l[2]=e=>A.onlyonce=e),color:"info",inset:"",density:"compact","hide-details":"",class:"small-switch"},null,8,["modelValue"])])])),_:1})])),_:1}),s(k,{"no-gutters":""},{default:o((()=>[s(P,{cols:"12",md:"4",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",_,[l[15]||(l[15]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"日历名称")],-1)),s(M,{modelValue:A.calname,"onUpdate:modelValue":l[3]||(l[3]=e=>A.calname=e),modelModifiers:{number:!0},density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue"])])])),_:1}),s(P,{cols:"12",md:"4",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",x,[l[16]||(l[16]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"时间取整间隔（分钟）")],-1)),s(M,{modelValue:A.interval_minutes,"onUpdate:modelValue":l[4]||(l[4]=e=>A.interval_minutes=e),modelModifiers:{number:!0},density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue"])])])),_:1}),s(P,{cols:"12",md:"4",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",h,[l[17]||(l[17]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"数据更新周期")],-1)),s(M,{modelValue:A.cron,"onUpdate:modelValue":l[5]||(l[5]=e=>A.cron=e),modelModifiers:{number:!0},density:"compact","hide-details":"",placeholder:"留空自动",style:{"max-width":"150px"}},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1})])),_:1}),s(L,{class:"my-4"}),s(k,null,{default:o((()=>[s(P,{cols:"4",md:"2"},{default:o((()=>[s($,{color:"primary",disabled:!I.value||U.value,onClick:S,loading:U.value,"prepend-icon":"mdi-download",variant:"tonal"},{default:o((()=>l[18]||(l[18]=[n("下载ICS文件")]))),_:1},8,["disabled","loading"])])),_:1}),s(P,{cols:"20",md:"10"},{default:o((()=>[i("div",w,[s(M,{modelValue:B.value.Basic.APP_DOMAIN,"onUpdate:modelValue":l[6]||(l[6]=e=>B.value.Basic.APP_DOMAIN=e),label:"iCal订阅链接",density:"compact",placeholder:"DOMAIN:PORT 或 IP:PORT","hide-details":"",class:"flex-grow-1"},null,8,["modelValue"]),s($,{icon:"mdi-content-copy",size:"small",variant:"text",color:"primary",onClick:z})])])),_:1})])),_:1}),s(K,{type:"info",title:"iCal订阅链接:"},{default:o((()=>l[19]||(l[19]=[i("div",{class:"space-y-2"},[i("ul",{class:"list-disc pl-5 space-y-1"},[i("li",null,"链接包含API密钥，请妥善保管防止泄露⚠️⚠️"),i("li",null,"将iCal链接添加到支持订阅的日历应用（如Outlook、Google Calendar等）"),i("li",null,"服务需公网访问，请将域名替换为您的公网IP或域名")])],-1)]))),_:1}),s(q,{class:"px-2 py-1"},{default:o((()=>[s(W),s($,{color:"secondary",variant:"text",onClick:R,"prepend-icon":"mdi-restore",size:"small"},{default:o((()=>l[20]||(l[20]=[n("恢复默认")]))),_:1}),s($,{color:"primary",disabled:!I.value||U.value,onClick:T,loading:U.value,"prepend-icon":"mdi-content-save",variant:"text",size:"small"},{default:o((()=>l[21]||(l[21]=[n("保存配置")]))),_:1},8,["disabled","loading"]),s($,{color:"grey",onClick:l[7]||(l[7]=e=>O("close")),"prepend-icon":"mdi-close",variant:"text",size:"small"},{default:o((()=>l[22]||(l[22]=[n("关闭")]))),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),s(F,{modelValue:D.show,"onUpdate:modelValue":l[10]||(l[10]=e=>D.show=e),color:D.color,timeout:D.timeout},{actions:o((()=>[s($,{variant:"text",onClick:l[9]||(l[9]=e=>D.show=!1)},{default:o((()=>l[23]||(l[23]=[n(" 关闭 ")]))),_:1})])),default:o((()=>[n(d(D.text)+" ",1)])),_:1},8,["modelValue","color","timeout"])])),_:1})])}}}),[["__scopeId","data-v-f80b2542"]]);export{O as default};
