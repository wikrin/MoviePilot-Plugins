import{importShared as e}from"./__federation_fn_import-D8XbxH1x.js";import{_ as l}from"./_plugin-vue_export-helper-BCo6x5W8.js";const{defineComponent:a}=await e("vue"),{resolveComponent:t,createVNode:s,createElementVNode:i,withCtx:o,createTextVNode:n,withModifiers:c,toDisplayString:d,openBlock:r,createElementBlock:u}=await e("vue"),m={class:"plugin-config"},p={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},f={class:"d-flex align-center"},v={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},g={class:"d-flex align-center"},b={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},y={class:"d-flex align-center"},_={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},h={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},x={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},w={class:"setting-item d-flex align-center justify-space-between pa-3 bg-grey-lighten-3 rounded"},V={class:"d-flex align-center mb-2"},{ref:C,reactive:P,onMounted:O}=await e("vue"),k=l(a({__name:"Config",props:{api:{type:Object,required:!0},initialConfig:{type:Object,default:()=>({})}},emits:["close","save"],setup(e,{emit:l}){const a=e,k=l,A=P({enabled:!1,calc_time:0,onlyonce:!1,interval_minutes:15,calname:"追剧日历",cron:"",dashboard_size:6}),I=P({...A}),j=C(!0),M=C(null),U=C(null),N=C(null),z=C(!1),B=C({Basic:{APP_DOMAIN:null,API_TOKEN:null}});async function S(){try{const e=await a.api.get("plugin/SubscribeCal/download/calendar.ics",{responseType:"text"});console.log(e);const l=new Blob([e],{type:"text/calendar"}),t=window.URL.createObjectURL(l),s=document.createElement("a");s.href=t,s.setAttribute("download",`${I.calname}.ics`),document.body.appendChild(s),s.click(),s.remove(),T("ICS 文件已成功下载","success")}catch(e){console.error("ICS 文件下载失败:",e),T("ICS 文件下载失败","error")}}async function D(){try{let e=B.value.Basic.APP_DOMAIN;const l=B.value.Basic.API_TOKEN;if(!e)return void T("域名未配置","warning");let a=e;a.startsWith("http://")||a.startsWith("https://")||(a="http://"+a);const t=new URL(`${a}/api/v1/plugin/SubscribeCal/subscribe`);t.searchParams.append("apikey",l),await navigator.clipboard.writeText(t.toString()),T("已复制到剪贴板！","success")}catch(e){console.error("操作失败:",e),T("复制失败，请检查浏览器权限或输入内容","error")}}const E=P({show:!1,text:"",color:"success",timeout:3e3});function T(e,l="success"){E.text=e,E.color=l,E.show=!0}async function R(){z.value=!0,U.value=null;try{k("save",{...I}),N.value="配置保存成功"}catch(e){console.error("保存配置失败:",e),U.value=e.message||"保存配置失败"}finally{z.value=!1}}function L(){Object.keys(A).forEach((e=>{I[e]=A[e]})),M.value&&M.value.resetValidation()}return O((()=>{a.initialConfig&&Object.keys(a.initialConfig).forEach((e=>{e in I&&(I[e]=a.initialConfig[e])})),async function(){try{const e=await a.api.get("system/env");if(e.success){for(const l of Object.keys(B.value))Object.keys(B.value[l]).forEach((a=>{e.data.hasOwnProperty(a)&&(B.value[l][a]=e.data[a])}));B.value.Basic.APP_DOMAIN||(B.value.Basic.APP_DOMAIN=`${window.location.origin}`)}}catch(e){console.log(e)}}()})),(e,l)=>{const a=t("v-icon"),C=t("v-card-title"),P=t("v-switch"),O=t("v-col"),A=t("v-row"),U=t("v-text-field"),N=t("v-card-text"),T=t("v-card"),$=t("v-divider"),K=t("v-btn"),W=t("v-alert"),q=t("v-spacer"),G=t("v-card-actions"),F=t("v-form"),H=t("v-snackbar");return r(),u("div",m,[s(T,{flat:"",class:"rounded border"},{default:o((()=>[s(C,{class:"text-subtitle-1 d-flex align-center px-3 py-2 bg-primary-lighten-5"},{default:o((()=>[s(a,{icon:"mdi-cog",class:"mr-2",color:"primary",size:"small"}),l[12]||(l[12]=i("span",null,"订阅日历配置",-1))])),_:1,__:[12]}),s(N,{class:"px-3 py-2"},{default:o((()=>[s(F,{ref_key:"form",ref:M,modelValue:j.value,"onUpdate:modelValue":l[9]||(l[9]=e=>j.value=e),onSubmit:c(R,["prevent"])},{default:o((()=>[s(T,{flat:"",class:"rounded mb-3 border config-card"},{default:o((()=>[s(N,{class:"px-3 py-2"},{default:o((()=>[s(A,{dense:"","no-gutters":""},{default:o((()=>[s(O,{cols:"12",md:"4",class:"pr-md-2 pb-2"},{default:o((()=>[i("div",p,[i("div",f,[s(a,{icon:"mdi-power",size:"small",color:I.enabled?"info":"grey",class:"mr-3"},null,8,["color"]),l[13]||(l[13]=i("span",{class:"text-subtitle-2"},"启用插件",-1))]),s(P,{modelValue:I.enabled,"onUpdate:modelValue":l[0]||(l[0]=e=>I.enabled=e),color:"info",inset:"",density:"compact","hide-details":"",class:"small-switch"},null,8,["modelValue"])])])),_:1}),s(O,{cols:"12",md:"4",class:"pr-md-2 pb-2"},{default:o((()=>[i("div",v,[i("div",g,[s(a,{icon:"mdi-history",size:"small",color:I.calc_time?"info":"grey",class:"mr-3"},null,8,["color"]),l[14]||(l[14]=i("span",{class:"text-subtitle-2"},"使用下载记录补充时间",-1))]),s(P,{modelValue:I.calc_time,"onUpdate:modelValue":l[1]||(l[1]=e=>I.calc_time=e),color:"info",inset:"",density:"compact","hide-details":"",class:"small-switch"},null,8,["modelValue"])])])),_:1}),s(O,{cols:"12",md:"4",class:"pr-md-2 pb-2"},{default:o((()=>[i("div",b,[i("div",y,[s(a,{icon:"mdi-update",size:"small",color:I.enabled?"info":"grey",class:"mr-3"},null,8,["color"]),l[15]||(l[15]=i("span",{class:"text-subtitle-2"},"立即更新一次",-1))]),s(P,{modelValue:I.onlyonce,"onUpdate:modelValue":l[2]||(l[2]=e=>I.onlyonce=e),color:"info",inset:"",density:"compact","hide-details":"",class:"small-switch"},null,8,["modelValue"])])])),_:1})])),_:1}),s(A,{"no-gutters":""},{default:o((()=>[s(O,{cols:"12",md:"3",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",_,[l[16]||(l[16]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"日历名称")],-1)),s(U,{modelValue:I.calname,"onUpdate:modelValue":l[3]||(l[3]=e=>I.calname=e),modelModifiers:{number:!0},density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue"])])])),_:1}),s(O,{cols:"12",md:"3",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",h,[l[17]||(l[17]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"时间取整间隔(分钟)")],-1)),s(U,{modelValue:I.interval_minutes,"onUpdate:modelValue":l[4]||(l[4]=e=>I.interval_minutes=e),modelModifiers:{number:!0},density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue"])])])),_:1}),s(O,{cols:"12",md:"3",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",x,[l[18]||(l[18]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"数据更新周期")],-1)),s(U,{modelValue:I.cron,"onUpdate:modelValue":l[5]||(l[5]=e=>I.cron=e),modelModifiers:{number:!0},density:"compact","hide-details":"",placeholder:"留空自动",style:{"max-width":"150px"}},null,8,["modelValue"])])])),_:1}),s(O,{cols:"12",md:"3",class:"pl-md-2 pb-2"},{default:o((()=>[i("div",w,[l[19]||(l[19]=i("div",{class:"d-flex align-center"},[i("span",{class:"text-subtitle-2"},"仪表盘宽度")],-1)),s(U,{modelValue:I.dashboard_size,"onUpdate:modelValue":l[6]||(l[6]=e=>I.dashboard_size=e),modelModifiers:{number:!0},density:"compact","hide-details":"",placeholder:"留空自动"},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1})])),_:1}),s($,{class:"my-4"}),s(A,null,{default:o((()=>[s(O,{cols:"4",md:"2"},{default:o((()=>[s(K,{color:"primary",disabled:!j.value||z.value,onClick:S,loading:z.value,"prepend-icon":"mdi-download",variant:"tonal"},{default:o((()=>l[20]||(l[20]=[n("下载ICS文件")]))),_:1,__:[20]},8,["disabled","loading"])])),_:1}),s(O,{cols:"20",md:"10"},{default:o((()=>[i("div",V,[s(U,{modelValue:B.value.Basic.APP_DOMAIN,"onUpdate:modelValue":l[7]||(l[7]=e=>B.value.Basic.APP_DOMAIN=e),label:"iCal订阅链接",density:"compact",placeholder:"DOMAIN:PORT 或 IP:PORT","hide-details":"",class:"flex-grow-1"},null,8,["modelValue"]),s(K,{icon:"mdi-content-copy",size:"small",variant:"text",color:"primary",onClick:D})])])),_:1})])),_:1}),s(W,{type:"info",title:"iCal订阅链接:"},{default:o((()=>l[21]||(l[21]=[i("div",{class:"space-y-2"},[i("ul",{class:"list-disc pl-5 space-y-1"},[i("li",null,"链接包含API密钥，请妥善保管防止泄露⚠️⚠️"),i("li",null,"将iCal链接添加到支持订阅的日历应用（如Outlook、Google Calendar等）"),i("li",null,"服务需公网访问，请将域名替换为您的公网IP或域名")])],-1)]))),_:1,__:[21]}),s(G,{class:"px-2 py-1"},{default:o((()=>[s(q),s(K,{color:"secondary",variant:"text",onClick:L,"prepend-icon":"mdi-restore",size:"small"},{default:o((()=>l[22]||(l[22]=[n("恢复默认")]))),_:1,__:[22]}),s(K,{color:"primary",disabled:!j.value||z.value,onClick:R,loading:z.value,"prepend-icon":"mdi-content-save",variant:"text",size:"small"},{default:o((()=>l[23]||(l[23]=[n("保存配置")]))),_:1,__:[23]},8,["disabled","loading"]),s(K,{color:"grey",onClick:l[8]||(l[8]=e=>k("close")),"prepend-icon":"mdi-close",variant:"text",size:"small"},{default:o((()=>l[24]||(l[24]=[n("关闭")]))),_:1,__:[24]})])),_:1})])),_:1},8,["modelValue"])])),_:1}),s(H,{modelValue:E.show,"onUpdate:modelValue":l[11]||(l[11]=e=>E.show=e),color:E.color,timeout:E.timeout},{actions:o((()=>[s(K,{variant:"text",onClick:l[10]||(l[10]=e=>E.show=!1)},{default:o((()=>l[25]||(l[25]=[n(" 关闭 ")]))),_:1,__:[25]})])),default:o((()=>[n(d(E.text)+" ",1)])),_:1},8,["modelValue","color","timeout"])])),_:1})])}}}),[["__scopeId","data-v-ddbd6790"]]);export{k as default};
